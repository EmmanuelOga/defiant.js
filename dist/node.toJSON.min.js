/*
 * defiant.js [v1.3.4]
 * http://www.defiantjs.com 
 * Copyright (c) 2013-2015, Hakan Bilgin <hbi@longscript.com> 
 * Licensed under the MIT License
 */
Defiant.node.toJSON=function(e,t){"use strict";var n=function(e){var t,u,o,r,a,d,l,i,s,h,c={},p=window;switch(e.nodeType){case 1:for(a=e.getAttribute("d:constr"),"Array"===a?c=[]:"String"===a&&""===e.textContent&&(c=""),t=e.attributes,i=0,s=t.length;s>i;i++)h=t.item(i),null===h.nodeName.match(/\:d|d\:/g)&&(a=e.getAttribute("d:"+h.nodeName),d=a&&"undefined"!==a?"null"===h.nodeValue?null:p[a]("false"===h.nodeValue?"":h.nodeValue):h.nodeValue,c["@"+h.nodeName]=d);break;case 3:u=e.parentNode.getAttribute("d:type"),d=u?p[u]("false"===e.nodeValue?"":e.nodeValue):e.nodeValue,c=d}if(e.hasChildNodes())for(i=0,s=e.childNodes.length;s>i;i++)if(o=e.childNodes.item(i),r=o.nodeName,t=e.attributes,"d:name"===r&&(r=o.getAttribute("d:name")),"#text"===r)a=e.getAttribute("d:constr"),"undefined"===a&&(a=void 0),l=o.textContent||o.text,d="Boolean"===a&&"false"===l?"":l,a||t.length?a&&1===s?c=p[a](d):e.hasChildNodes()&&t.length<3?c=a?p[a](d):d:c[r]=a?p[a](d):d:c=d;else{if("null"===o.getAttribute("d:constr")){c[r]&&c[r].push?c[r].push(null):o.previousSibling?c[r]=[c[r],null]:c[r]=[c[r]];continue}if(c[r]){c[r].push?c[r].push(n(o)):c[r]=[c[r],n(o)];continue}switch(a=o.getAttribute("d:constr")){case"null":c.push?c.push(null):c[r]=null;break;case"Array":o.parentNode.firstChild===o&&"Array"===a&&"d:item"!==r?"d:item"===r||"Array"===a?(d=n(o),c[r]=d.length?[d]:d):c[r]=n(o):c.push?c.push(n(o)):c[r]=n(o);break;case"String":case"Number":case"Boolean":l=o.textContent||o.text,d="Boolean"===a&&"false"===l?"":l,c.push?c.push(p[a](d)):c[r]=n(o);break;default:c.push?c.push(n(o)):c[r]=n(o)}}return 1===e.nodeType&&"ArrayItem"===e.getAttribute("d:type")&&(c=[c]),c},u=9===e.nodeType?e.documentElement:e,o=n(u),r=o[u.nodeName];return u===u.ownerDocument.documentElement&&r&&r.constructor===Array&&(o=r),t&&"true"===t.toString()&&(t="	"),t?JSON.stringify(o,null,t):o};